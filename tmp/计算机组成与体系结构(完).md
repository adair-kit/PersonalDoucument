# 一 .计算机组成原理与体系结构

## 数据的表示

* 十进制转R进制: 使用短除法
* 二进制转八进制与十六进制: 三转一 , 四转一

|      | 数值1     | 数值-1    | 数值1-1   |
| ---- | --------- | --------- | --------- |
| 原码 | 0000 0001 | 1000 0001 | 1000 0010 |
| 反码 | 0000 0001 | 1111 1110 | 1111 1111 |
| 补码 | 0000 0001 | 1111 1111 | 0000 0000 |
| 移码 | 1000 0001 | 0111 1111 | 1000 0000 |

* **反码:** 正数部分不变,负数在原码基础上**数值位**按位取反
* **补码:** 正数部分不变,负数在反码基础上+1
* **移码:** 在补码基础上**符号位**取反

### 数值表示范围

|      | 定点整数                   | 定点小数                          | 范围       |
| ---- | -------------------------- | --------------------------------- | ---------- |
| 原码 | -(2^n-1^-1) **~** 2^n-1^-1 | -(1-2^-(n-1)^)  **~** 1-2^-(n-1)^ | 2^n-1^个数 |
| 反码 | -(2^n-1^-1) **~** 2^n-1^-1 | -(1-2^-(n-1)^)  **~** 1-2^-(n-1)^ | 2^n-1^个数 |
| 补码 | -2^n-1^ **~** 2^n-1^-1     | -1 **~** 1-2^-(n-1)^              | 2^n^个数   |
| 移码 | -2^n-1^ **~** 2^n-1^-1     | -1 **~** 1-2^-(n-1)^              | 2^n^个数   |

* 定点整数-128的补码为 1000 0000是人为规定
* 定点小数-1的补码为   1000 0000是人为规定
* n为**带符号位**的长度 , 如果不连符号位则不需要-1
* 定点小数位整数各部分除以 **2^n-1^**

### 浮点数运算

* N = 尾数 * 基数^指数^
* 一般尾数用**补码** , 阶码用**移码**
* **阶码的位数**决定数的**表示范围** , 位数越多范围越大
* **尾数的位数**决定数的**有效精度** , 位数越多精度越高
* 对阶时 , **小数向大数看起**
* 对阶时通过较**小数的尾数右移**实现

### 其他
* 逻辑与：全1为1
* 逻辑或：有1为1
* 算数左移 * 2 ，右移 / 2
* 使用补码来表示和运算数据可以 **简化计算机运算部件的设计**
* 小数点是 **隐含规定**，不是二进制位表示

## 计算机结构

|        | emmm               | emmm                                        |
| ------ | ------------------ | ------------------------------------------- |
| 计算器 | 算术逻辑单元 ALU   | 数据的算数运算和逻辑运算                    |
| ^      | 累加寄存器 AC      | **通用寄存器**,为ALU提供工作去,**暂存数据** |
| ^      | 数据缓冲寄存器 DR  | 写内存时,暂存指令或数据                     |
| ^      | 状态条件寄存器 PSW | 存状态标志与控制标志(**争议**)如进位、溢出  |
| 控制器 | 程序计数器 PC      | 存储下一条要执行指令的地址                  |
| ^      | 指令寄存器 IR      | 存储即将执行的指令                          |
| ^      | 指令译码器 ID      | 对指令中的操作码字段进行分析解释            |
| ^      | 时序部件           | 提供时序控制信号                            |

### 其他
* **指令寄存器** 用来存放当前正在执行的指令，**对用户是完全透明** 的。
* 编写汇编语言程序，程序员可访问的是 **程序计数器**
* 跟踪指令地址的寄存器是 **程序计数器**
* **控制器** 保证指令的正确执行和异常处理
* CPU依据 **指令和数据的寻址方式** 来区分内存中以二进制存放的指令和数据
* CPU先从 **程序计数器** 中取出指令在内存中的地址,通过地址总线寻址获取

## 计算机体系结构分类 - Flynn

| 体系结构类型             | 结构                                            | 关键特性                           | 代表                                           |
| ------------------------ | ----------------------------------------------- | ---------------------------------- | ---------------------------------------------- |
| 单指令流单数据流<br>SISD | 控制器部分:一个<br>处理器:一个<br>主存模块:一个 | /                                  | 单处理器系统                                   |
| 单指令流多数据流<br>SIMD | 控制器部分:一个<br>处理器:多个<br>主存模块:多个 | 各处理器以异步的方式执行同一条指令 | 并行处理机<br>**阵列处理机**<br>超级向量处理机 |
| 多指令流单数据流<br>MISD | 控制器部分:多个<br>处理器:一个<br>主存模块:多个 | 被证明不可能,不实际                | **流水线计算机**                               |
| 多指令流多数据流<br>MIMD | 控制器部分:多个<br>处理器:多个<br>主存模块:多个 | 能够实现**作业,指令,任务**全面并行 | 多处理机系统<br>多计算机                       |



## 寻址方式

| 寻址方式           | 特点                       |
| ------------------ | -------------------------- |
| 立即寻址方式       | 操作数直接存存放在指令中   |
| 直接寻址方式       | 指令中存放操作数的地址     |
| 间接寻址方式       | 指令中存放操作数地址的地址 |
| 寄存器寻址方式     | 寄存器存放操作数           |
| 寄存器间接寻址方式 | 寄存器存放操作数的地址     |

### 其他
* 操作码代表执行什么操作，地址码包含操作数的地址及结果存放地址等
* 采用不同寻址方式目的是 **扩大寻址空间并提高编程的灵活性**
* MOV R1,#45 R1是寄存器，寄存器寻址和立即寻址
* 相联存储器是一种按 **存储内容** 来存储和访问的存储器，不属于按寻址方式划分的存储器。


## CISC和RISC

| 指令系统类型 | 指令                                                                          | 寻址方式   | 实现方式                                             | 其他                        |
| ------------ | ----------------------------------------------------------------------------- | ---------- | ---------------------------------------------------- | --------------------------- |
| CISC(复杂)   | 数量多,使用频率差别大,可变长格式                                              | 支持多种   | 微程序控制技术(微码)                                 | 研制周期长                  |
| RISC(精简)   | 数量少,频率接近,定长格式,大部分为单周期指令,操作寄存器,只有Load/Store操作内存 | 支持方式少 | 增加了通用寄存器 ; 硬布线逻辑控制为主 适合采用流水线 | 优化编译 , 有效支持高级语言 |

### 其他
* VLIW：（Very Long Instruction Word，超长指令字）

## 流水线

* **流水线周期 :** 为执行时间最长的一段  Δt

### 流水线计算公式

* **理论公式 :** (一条指令执行时间) + (n-1) * Δt
* **实践公式 :** k * Δt + (n-1)*Δt  ;  **k为一条指令需要几步**

### 超标量流水线

* 指令数除以超标的度向下取整，再算时间

### 流水线吞吐率
* 单位时间内流水线所完成任务数量或输出的结果数量

$\boxed{TP=\frac {\text{指令条数}} {\text{流水线执行时间}}}$

### 流水线最大吞吐率

$\boxed{ TP_\text{max} = \frac 1 {\Delta\text{t}} }$

* 对于一个持续处理与业务的系统而言,**相应时间越短,作业吞吐量越大**

## 计算机层次化存储结构

| 速度快(容量小)   -->速度慢(容量大) |                                    |
| ---------------------------------- | ---------------------------------- |
| CPU                                | 寄存器 **最快,但容量最小,成本高**  |
| Cache                              | 按内容存取                         |
| 内存(主存)                         | 随机存储器(RAM)<br>只读存储器(ROM) |
| 外存(辅存)                         | 硬盘,光盘,U盘等                    |

### 其他
* 主存主要是由 **DRAM** 构成

## Cache

### 概念

* 在计算机的存储体系结构种 , Cache时访问速度最快的层次(若有寄存器,则寄存器最快)
* 使用Cache改善系统性能的依据时程序的局部性原理
* $\boxed{ t_3= h*t-1 + (1-h)*t_2  }$ t1为Cache的周期时间 , t2为主存储器的时间 h为对Cache访问的命中率  1-h为失效率(未命中率)

### 映像
* 直接相联映像 : 硬件电路简单, **冲突率很高**
* 全相联映像 : 电路难于设计和实现 , 只适用于最小容量的Cache , **冲突率较低**
* 组相联映像 : 直接相连与全相联的折中
* 地址映像 : 将内存与Cache的存储空间划分未若干大小相同的页(块)

### 全相联

| 主存页标记 | 业内地址 |
| ---------- | -------- |

### 直接相联

| 主存页标记 | Cache页号 | 业内地址 |
| ---------- | --------- | -------- |
| >          | 主存页号  | /        |
| /          | Cache地址 |          |

### 组相联

| 主存页标记 | Cache组号号 | 组内页号   | 业内地址 |
| ---------- | ----------- | ---------- | -------- |
| >          | >           | 主存页标记 | /        |
| /          | Cache地址   |            |          |

### 其他
* 相联存储器一种按 **内容** 进行存储和访问的存储器。
* Cache与主存间地址映射是由**硬件自动完成的** 

## 主存 - 编址与计算

* 存储单元
* **按字编址 :** 存储体的存储单元是字存储单元 , 即最小寻址单位是一个字
* **按字节编址 :** 存储体的存储单元是字节存储单元 , 即最小寻址单位是一个字节
* 求芯片数量 $\boxed{\text{总片数} = \frac {\text{总容量}} {\text{每片的容量}}}$

### 其他
* 片内地址，片选地址
* 寻址范围：根据字长获得一个地址占用多少字节，再用总容量除以 
* **字长** 同一时间CPU处理二进制的位数，数据与地址总线宽度与此相同

## 总线
* 一条总线**同一时刻仅允许一个设备发送 , 但允许多个设备接收**
* **数据总线 :** 在CPU与RAM之间来回传送需要处理或是需要存储的数据
* **地址总线 :** 用来指定在RAM中存储的数据的地址
* **控制总线 :** 将微处理器控制单元的信号传送到周边设备

### 其他
* 总线带宽计算 每秒传输多少字（看具体，时钟频率/多少个时钟周期传多少数据）
* 在计算机系统中采用总线结构，便于 **实现系统的积木化构造** ，**同时可以有效减少信息传输线的数量**
* 总线复用方式可以 **减少总线中信号线的数量**
* 总线：PC、ISA、EISA、PCI，SCSI不是
* 单总线结构的优点是 **控制简单方便，扩充方便** 。但由于所有设备部件均挂在单一总线上，使这种结构只能分时工作，即同一时刻只能在两个设备之间传送数据，这就使系统总体 **数据传输的效率和速度受到限制**，这是单总线结构的主要缺点

## 串联系统与并联系统可靠度计算

### 串联

$\boxed{R = R_1 * R_2 * .. R_n}$

### 并联

$\boxed{R = 1-(1-R_1)*(1-R_2*...*(1-R_n))}$

### N模混合

* 确定串并联

### 其他
* **可靠性** 可用 MTBF/(1+MTBF) MTBF为平均失效间隔时间 来度量
* 冗余技术一般包括时间冗余、信息冗余、结构冗余和冗余附加技术，其中 **结构冗余** 按照工作方法可以分为静态、动态和混合冗余。
* 冗佘附加技术的构成不包括 **关键程序和数据的冗余存储及调用**
* **可靠性** 不取决于软件产品的使用方式（开发方式有争议）

## 校验码

### 奇偶校验码

* **奇校验 :** 整个校验码(有效位和信息位)中'1'的个数为奇数
* **偶校验 :** 整个校验码(有效位和信息位)中'1'的个数为偶数
* **奇偶校验 , 可检查一位的错误 , 不可纠错**

### 循环校验码(CRC)
* 可检错 , 不可纠错
* 模2除法
* 将多项式转为2进制 , 用原始报文后面添上多项式位数-1个0并对其进行模2除法 ,将最后的余数拼接在原始报文之后

### 海明码(汉明码)
* 可检错 , 也可纠错
* $2^r\ge{m+r+1}$ m为数据位 r为校验位

## 补充